{"version":3,"file":"main-fhItiokd.js","sources":["../../main.js","../../app.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 'https://upznvkoiiiazvnuowhdr.supabase.co'\r\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || 'sb_publishable_TaFJ0GGjMhmCGnGi4N4dyA_auGwFljE'\r\n\r\nexport const supabase = createClient(\r\n  supabaseUrl,\r\n  supabaseAnonKey\r\n)\r\n","// --- Supabase setup ---\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = 'https://upznvkoiiiazvnuowhdr.supabase.co'\r\nconst supabaseKey = 'sb_publishable_TaFJ0GGjMhmCGnGi4N4dyA_auGwFljE'\r\nconst supabase = createClient(supabaseUrl, supabaseKey)\r\n\r\n// Data storage\r\nlet students = [];\r\nlet absences = [];\r\nlet reports = [];\r\nlet homeworks = {};\r\nlet currentUser = '';\r\nlet currentSection = 'dashboard';\r\n\r\n// User credentials\r\nconst users = {\r\n    'Kati': 'sun12',\r\n    'Alvaro': 'rock34',\r\n    'Juan Ignacio': 'wiz56',\r\n    'Maria Jose': 'moon78',\r\n    'Jose Antonio': 'thun90',\r\n    'Lourdes': 'rain21',\r\n    'Ruben': 'comet43',\r\n    'Belen': 'star65',\r\n    'Adolfo': 'king999'\r\n};\r\n\r\n// Initialize rooms\r\nfunction initializeRooms() {\r\n    // Estructura de habitaciones:\r\n    // Planta 1: Hombres 101-104 (izq), Mujeres 201-202 (der)\r\n    // Planta 2: Hombres 201-204 (izq), Mujeres 301-304 (der)\r\n    // Cada habitaciÃ³n tiene 6 camas: A, B, C, D, E, F\r\n    rooms = [];\r\n    \r\n    const bedLetters = ['A', 'B', 'C', 'D', 'E', 'F'];\r\n    \r\n    const createRooms = (startNum, endNum, gender, floor, side) => {\r\n        for (let i = startNum; i <= endNum; i++) {\r\n            const number = `${i}`;\r\n            const beds = {};\r\n            bedLetters.forEach(letter => {\r\n                beds[letter] = null; // null significa cama vacÃ­a\r\n            });\r\n            \r\n            rooms.push({ \r\n                number, \r\n                capacity: 6, \r\n                occupied: 0, \r\n                beds: beds, // estructura: { A: studentId/null, B: studentId/null, ... }\r\n                type: 'para 6', \r\n                gender: gender, \r\n                floor: floor,\r\n                side: side\r\n            });\r\n        }\r\n    };\r\n    \r\n    // Planta 1 - Hombres (101-104)\r\n    createRooms(101, 104, 'hombre', 1, 'izquierda');\r\n    \r\n    // Planta 1 - Mujeres (201-202)\r\n    createRooms(201, 202, 'mujer', 1, 'derecha');\r\n    \r\n    // Planta 2 - Hombres (211-214)\r\n    createRooms(211, 214, 'hombre', 2, 'izquierda');\r\n    \r\n    // Planta 2 - Mujeres (301-304)\r\n    createRooms(301, 304, 'mujer', 2, 'derecha');\r\n}\r\n\r\n// Utility: calculate age in years from a YYYY-MM-DD date string\r\nfunction calculateAge(dateString) {\r\n    if (!dateString) return null;\r\n    const today = new Date();\r\n    const birth = new Date(dateString);\r\n    if (isNaN(birth)) return null;\r\n    let age = today.getFullYear() - birth.getFullYear();\r\n    const m = today.getMonth() - birth.getMonth();\r\n    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {\r\n        age--;\r\n    }\r\n    return age;\r\n}\r\n\r\n// Check for birthdays today\r\nfunction checkBirthdays() {\r\n    const today = new Date();\r\n    const currentMonth = today.getMonth() + 1; // 1-12\r\n    const currentDay = today.getDate();\r\n    \r\n    const birthdayStudents = students.filter(student => {\r\n        if (!student.fechaNacimiento) return false;\r\n        const birthDate = new Date(student.fechaNacimiento + 'T00:00:00');\r\n        if (isNaN(birthDate)) return false;\r\n        \r\n        const birthMonth = birthDate.getMonth() + 1;\r\n        const birthDay = birthDate.getDate();\r\n        \r\n        return birthMonth === currentMonth && birthDay === currentDay;\r\n    });\r\n    \r\n    if (birthdayStudents.length > 0) {\r\n        showBirthdayModal(birthdayStudents);\r\n    }\r\n}\r\n\r\nfunction showBirthdayModal(students) {\r\n    const modal = document.getElementById('birthdayModal');\r\n    const message = document.getElementById('birthdayMessage');\r\n    \r\n    if (students.length === 1) {\r\n        message.textContent = `Hoy es el cumpleaÃ±os de ${students[0].nombre}`;\r\n    } else {\r\n        const names = students.map(s => s.nombre).join(', ');\r\n        message.textContent = `Â¡Hoy es el cumpleaÃ±os de ${names}!`;\r\n    }\r\n    \r\n    modal.classList.remove('hidden');\r\n    \r\n    // Create confetti animation\r\n    createConfetti();\r\n    \r\n    // Auto-close after 6 seconds\r\n    setTimeout(() => {\r\n        closeBirthdayModal();\r\n    }, 6000);\r\n}\r\n\r\nfunction closeBirthdayModal() {\r\n    const modal = document.getElementById('birthdayModal');\r\n    modal.classList.add('hidden');\r\n}\r\n\r\nfunction createConfetti() {\r\n    const container = document.getElementById('confettiContainer');\r\n    if (!container) return;\r\n    \r\n    // Clear previous confetti\r\n    container.innerHTML = '';\r\n    \r\n    const confettiPieces = 50;\r\n    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];\r\n    \r\n    for (let i = 0; i < confettiPieces; i++) {\r\n        const piece = document.createElement('div');\r\n        piece.className = 'confetti-piece absolute w-2 h-2 rounded-full';\r\n        piece.style.left = Math.random() * 100 + '%';\r\n        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];\r\n        piece.style.animationDelay = (Math.random() * 0.5) + 's';\r\n        piece.style.opacity = '0.8';\r\n        container.appendChild(piece);\r\n    }\r\n}\r\n\r\n/// --- Global variables ---\r\n// Note: students, absences, reports, homeworks are already declared at the top of the file\r\n\r\n// --- Load data from Supabase ---\r\nasync function loadData() {\r\n    // Fetch students\r\n    const { data: studentsData, error: studentsError } = await supabase\r\n        .from('students')\r\n        .select('*');\r\n\r\n    students = studentsError ? [] : studentsData;\r\n    if (studentsError) console.error('Error loading students:', studentsError);\r\n\r\n    // Fetch absences\r\n    const { data: absencesData, error: absencesError } = await supabase\r\n        .from('absences')\r\n        .select('*');\r\n\r\n    absences = absencesError ? [] : absencesData;\r\n    if (absencesError) console.error('Error loading absences:', absencesError);\r\n\r\n    // Fetch reports\r\n    const { data: reportsData, error: reportsError } = await supabase\r\n        .from('reports')\r\n        .select('*');\r\n\r\n    reports = reportsError ? [] : reportsData;\r\n    if (reportsError) console.error('Error loading reports:', reportsError);\r\n\r\n    // Initialize UI\r\n    initializeRooms();\r\n    updateDashboard();\r\n    updateStudentsTable();\r\n    updateRoomsGrid();\r\n    updateAbsencesTable();\r\n    updateReportsTable();\r\n    populateDropdowns();\r\n    loadHomeworks(); // optional\r\n    renderAgenda();\r\n    checkBirthdays();\r\n\r\n    // Optional: save fetched data to localStorage\r\n    localStorage.setItem('students', JSON.stringify(students));\r\n    localStorage.setItem('absences', JSON.stringify(absences));\r\n    localStorage.setItem('reports', JSON.stringify(reports));\r\n}\r\n\r\n// --- Save functions ---\r\nasync function saveStudent(student) {\r\n    const { error } = await supabase\r\n        .from('students')\r\n        .upsert(student, { onConflict: ['id'] });\r\n    if (error) console.error('Error saving student:', error);\r\n}\r\n\r\nasync function saveAbsence(absence) {\r\n    const { error } = await supabase\r\n        .from('absences')\r\n        .upsert(absence, { onConflict: ['id'] });\r\n    if (error) console.error('Error saving absence:', error);\r\n}\r\n\r\nasync function saveReport(report) {\r\n    const { error } = await supabase\r\n        .from('reports')\r\n        .upsert(report, { onConflict: ['id'] });\r\n    if (error) console.error('Error saving report:', error);\r\n}\r\n\r\n// --- Add new student example ---\r\nasync function addNewStudent(student) {\r\n    students.push(student);\r\n    await saveStudent(student);\r\n    updateDashboard();\r\n    updateStudentsTable();\r\n}\r\n\r\n// --- Initialize app ---\r\nasync function initApp() {\r\n    await loadData();\r\n}\r\n\r\ninitApp();\r\n\r\n// Login functionality\r\ndocument.getElementById('loginForm').addEventListener('submit', function(e) {\r\n    e.preventDefault();\r\n    \r\n    const username = document.getElementById('username').value;\r\n    const password = document.getElementById('password').value;\r\n    const errorDiv = document.getElementById('loginError');\r\n    \r\n    if (users[username] && users[username] === password) {\r\n        currentUser = username;\r\n        document.getElementById('currentUser').textContent = `Bienvenido, ${username}`;\r\n        document.getElementById('loginScreen').classList.add('hidden');\r\n        document.getElementById('mainApp').classList.remove('hidden');\r\n        loadData();\r\n        showSection('dashboard');\r\n        errorDiv.classList.add('hidden');\r\n    } else {\r\n        errorDiv.textContent = 'Usuario o contraseÃ±a incorrectos';\r\n        errorDiv.classList.remove('hidden');\r\n    }\r\n});\r\n\r\n// Logout functionality\r\ndocument.getElementById('logoutBtn').addEventListener('click', function() {\r\n    currentUser = '';\r\n    document.getElementById('username').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('loginScreen').classList.remove('hidden');\r\n    document.getElementById('mainApp').classList.add('hidden');\r\n    document.getElementById('loginError').classList.add('hidden');\r\n});\r\n\r\n// Navigation functionality\r\ndocument.querySelectorAll('.nav-link').forEach(link => {\r\n    link.addEventListener('click', function(e) {\r\n        e.preventDefault();\r\n        const section = this.getAttribute('data-section');\r\n        showSection(section);\r\n    });\r\n});\r\n\r\ndocument.getElementById('mobileNav').addEventListener('change', function() {\r\n    showSection(this.value);\r\n});\r\n\r\n// When selecting a student in the assign form, refresh available rooms\r\ndocument.getElementById('roomStudent')?.addEventListener('change', populateDropdowns);\r\n\r\nfunction showSection(sectionName) {\r\n    document.querySelectorAll('.content-section').forEach(section => {\r\n        section.classList.add('hidden');\r\n    });\r\n    document.getElementById(sectionName).classList.remove('hidden');\r\n    currentSection = sectionName;\r\n}\r\n\r\n// Add student functionality\r\ndocument.getElementById('addStudentForm').addEventListener('submit', function(e) {\r\n    e.preventDefault();\r\n\r\n    const student = {\r\n        id: Date.now(),\r\n        nombre: document.getElementById('studentNombre').value,\r\n        fechaNacimiento: document.getElementById('studentNacimiento').value,\r\n        mayor16: !!document.getElementById('studentMayor16').checked,\r\n        gender: document.getElementById('studentGenero').value,\r\n        curso: document.getElementById('studentCurso').value,\r\n        telefono1: document.getElementById('studentTelefono1').value,\r\n        telefono2: document.getElementById('studentTelefono2').value,\r\n        habitacion: null\r\n    };\r\n\r\n    // compute ageGroup: assumption >=18 is 'mayor'\r\n    const age = calculateAge(student.fechaNacimiento);\r\n    student.ageGroup = (age !== null && age >= 18) ? 'mayor' : 'menor';\r\n\r\n    students.push(student);\r\n    saveData();\r\n    updateDashboard();\r\n    updateStudentsTable();\r\n    populateDropdowns();\r\n    \r\n    // Reset form\r\n    this.reset();\r\n    \r\n    // Show success message\r\n    addActivity(`Nuevo alumno aÃ±adido: ${student.nombre}`);\r\n});\r\n\r\n// Update dashboard\r\nfunction updateDashboard() {\r\n    document.getElementById('totalAlumnos').textContent = students.length;\r\n    document.getElementById('habitacionesOcupadas').textContent = rooms.filter(room => room.occupied > 0).length;\r\n    document.getElementById('totalFaltas').textContent = absences.length;\r\n}\r\n\r\n// Update students table\r\nfunction updateStudentsTable() {\r\n    const tbody = document.getElementById('studentsTableBody');\r\n    \r\n    if (students.length === 0) {\r\n        tbody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center py-8 text-gray-500\">No hay alumnos registrados</td></tr>';\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = students.map(student => {\r\n        const age = calculateAge(student.fechaNacimiento);\r\n        const nacimientoDate = new Date(student.fechaNacimiento + 'T00:00:00');\r\n        const nacimientoStr = nacimientoDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n        \r\n        return `\r\n        <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\r\n            <td class=\"py-3 px-4 font-medium\">${student.nombre}</td>\r\n            <td class=\"py-3 px-4 text-sm\">${nacimientoStr}</td>\r\n            <td class=\"py-3 px-4\"><span class=\"bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm font-medium\">${age} aÃ±os</span></td>\r\n            <td class=\"py-3 px-4\">${student.gender || '-'}</td>\r\n            <td class=\"py-3 px-4\">${student.curso}</td>\r\n            <td class=\"py-3 px-4 text-sm text-gray-600\">${student.telefono1 || '-'}${student.telefono2 ? '<br/>' + student.telefono2 : ''}</td>\r\n            <td class=\"py-3 px-4\">\r\n                ${student.habitacion ? `<span class=\"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs\">${student.habitacion}</span>` : '<span class=\"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs\">Sin asignar</span>'}\r\n            </td>\r\n            <td class=\"py-3 px-4\">\r\n                <button onclick=\"openStudentSeguimiento(${student.id})\" title=\"Seguimiento acadÃ©mico\" class=\"text-indigo-600 hover:text-indigo-800 mr-2\">\r\n                    <i class=\"fas fa-book\"></i>\r\n                </button>\r\n                <button onclick=\"editStudent(${student.id})\" class=\"text-blue-600 hover:text-blue-800 mr-2\">\r\n                    <i class=\"fas fa-edit\"></i>\r\n                </button>\r\n                <button onclick=\"deleteStudent(${student.id})\" class=\"text-red-600 hover:text-red-800\">\r\n                    <i class=\"fas fa-trash\"></i>\r\n                </button>\r\n            </td>\r\n        </tr>`;\r\n    }).join('');\r\n}\r\n\r\n// Update rooms grid\r\nfunction updateRoomsGrid() {\r\n    const grid = document.getElementById('roomsGrid');\r\n\r\n    // Group rooms by floor\r\n    const floors = {\r\n        1: { izquierda: [], derecha: [] },\r\n        2: { izquierda: [], derecha: [] }\r\n    };\r\n\r\n    rooms.forEach(room => {\r\n        const floor = room.floor || 1;\r\n        const side = room.side || 'izquierda';\r\n        if (!floors[floor]) floors[floor] = { izquierda: [], derecha: [] };\r\n        floors[floor][side].push(room);\r\n    });\r\n\r\n    const renderRoomCard = (room) => {\r\n        const occupiedCount = Object.values(room.beds).filter(bed => bed !== null).length;\r\n        const bedLetters = Object.keys(room.beds).sort();\r\n        \r\n        return `\r\n        <div class=\"bg-white p-6 rounded-xl shadow-sm border-2 ${occupiedCount === room.capacity ? 'border-red-300 bg-red-50' : occupiedCount > 0 ? 'border-yellow-300 bg-yellow-50' : 'border-green-300 bg-green-50'}\">\r\n            <div class=\"flex justify-between items-start mb-4\">\r\n                <div>\r\n                    <h3 class=\"text-lg font-semibold text-gray-800\">HabitaciÃ³n ${room.number}</h3>\r\n                    <p class=\"text-sm text-gray-600\">\r\n                        <span class=\"font-medium\">${room.gender === 'hombre' ? 'ðŸ‘¨ Hombres' : 'ðŸ‘© Mujeres'}</span> \r\n                        Â· Planta ${room.floor}\r\n                    </p>\r\n                </div>\r\n                <span class=\"px-3 py-1 rounded-full text-xs font-medium ${occupiedCount === 0 ? 'bg-green-100 text-green-800' : occupiedCount === room.capacity ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}\">${occupiedCount}/${room.capacity}</span>\r\n            </div>\r\n            <div class=\"grid grid-cols-3 gap-2 mb-4\">\r\n                ${bedLetters.map(bed => {\r\n                    const studentId = room.beds[bed];\r\n                    const student = studentId ? students.find(s => s.id === studentId) : null;\r\n                    return `\r\n                        <div class=\"flex flex-col items-center p-3 rounded-lg ${student ? 'bg-indigo-100 border-2 border-indigo-300' : 'bg-gray-100 border-2 border-gray-300'}\">\r\n                            <span class=\"text-xs font-bold text-gray-600 mb-1\">Cama ${bed}</span>\r\n                            ${student ? `\r\n                                <span class=\"text-xs text-center text-gray-700 font-medium\">${student.nombre.split(' ')[0]}</span>\r\n                            ` : `\r\n                                <span class=\"text-xs text-gray-500\">Vacante</span>\r\n                            `}\r\n                        </div>\r\n                    `;\r\n                }).join('')}\r\n            </div>\r\n            ${occupiedCount < room.capacity ? `<button onclick=\"assignRoomToStudent('${room.number}')\" class=\"w-full bg-indigo-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors\">Asignar</button>` : ''}\r\n        </div>\r\n    `;\r\n    };\r\n\r\n    // Build HTML by floors\r\n    let html = '';\r\n\r\n    [1, 2].forEach(floor => {\r\n        const floorData = floors[floor] || { izquierda: [], derecha: [] };\r\n        const floorLabel = floor === 1 ? 'PLANTA 1' : 'PLANTA 2';\r\n        \r\n        html += `\r\n            <div class=\"mb-8\">\r\n                <h3 class=\"text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-600 pb-2\">${floorLabel}</h3>\r\n                <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n                    <!-- Izquierda (Hombres) -->\r\n                    <div>\r\n                        <h4 class=\"text-lg font-semibold text-gray-700 mb-4 text-center p-3 bg-blue-100 rounded-lg\">ðŸ‘¨ HOMBRES (Izquierda)</h4>\r\n                        <div class=\"space-y-4\">\r\n                            ${floorData.izquierda.length > 0 \r\n                                ? floorData.izquierda.map(room => renderRoomCard(room)).join('') \r\n                                : '<p class=\"text-gray-500 text-center py-6\">No hay habitaciones de hombres</p>'\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <!-- Derecha (Mujeres) -->\r\n                    <div>\r\n                        <h4 class=\"text-lg font-semibold text-gray-700 mb-4 text-center p-3 bg-pink-100 rounded-lg\">ðŸ‘© MUJERES (Derecha)</h4>\r\n                        <div class=\"space-y-4\">\r\n                            ${floorData.derecha.length > 0 \r\n                                ? floorData.derecha.map(room => renderRoomCard(room)).join('') \r\n                                : '<p class=\"text-gray-500 text-center py-6\">No hay habitaciones de mujeres</p>'\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    });\r\n\r\n    grid.innerHTML = html;\r\n}\r\n\r\n// Update absences table\r\nfunction updateAbsencesTable() {\r\n    const tbody = document.getElementById('absencesTableBody');\r\n    const filterStudent = document.getElementById('filterStudent').value;\r\n    const filterDate = document.getElementById('filterDate').value;\r\n    \r\n    let filteredAbsences = absences;\r\n    \r\n    if (filterStudent) {\r\n        filteredAbsences = filteredAbsences.filter(absence => \r\n            absence.studentId == filterStudent\r\n        );\r\n    }\r\n    \r\n    if (filterDate) {\r\n        filteredAbsences = filteredAbsences.filter(absence => \r\n            absence.fecha === filterDate\r\n        );\r\n    }\r\n    \r\n    if (filteredAbsences.length === 0) {\r\n        tbody.innerHTML = '<tr><td colspan=\"4\" class=\"text-center py-8 text-gray-500\">No hay faltas registradas</td></tr>';\r\n        return;\r\n    }\r\n    \r\n    tbody.innerHTML = filteredAbsences.map(absence => {\r\n        const student = students.find(s => s.id === absence.studentId);\r\n        return `\r\n            <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\r\n                <td class=\"py-3 px-4 font-medium\">${student ? `${student.nombre}` : 'Alumno eliminado'}</td>\r\n                <td class=\"py-3 px-4\">${absence.fecha}</td>\r\n                <td class=\"py-3 px-4\">${absence.descripcion}</td>\r\n                <td class=\"py-3 px-4\">\r\n                    <button onclick=\"deleteAbsence(${absence.id})\" class=\"text-red-600 hover:text-red-800\">\r\n                        <i class=\"fas fa-trash\"></i>\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// Assign room functionality\r\ndocument.getElementById('assignRoomForm').addEventListener('submit', function(e) {\r\n    e.preventDefault();\r\n    \r\n    const studentId = parseInt(document.getElementById('roomStudent').value);\r\n    const roomNumber = document.getElementById('roomNumber').value;\r\n    const selectedBed = document.getElementById('roomBed') ? document.getElementById('roomBed').value : '';\r\n    \r\n    const student = students.find(s => s.id === studentId);\r\n    const room = rooms.find(r => r.number === roomNumber);\r\n    \r\n    if (!student || !room) return;\r\n    \r\n    // Compatibility checks: gender\r\n    const studentGender = student.gender;\r\n    if (room.gender && room.gender !== 'mixta' && studentGender !== 'otro' && room.gender !== studentGender) {\r\n        alert('La habitaciÃ³n seleccionada no es compatible con el gÃ©nero del alumno.');\r\n        return;\r\n    }\r\n    \r\n    // Determine bed to assign: chosen bed or first empty\r\n    let emptyBed = null;\r\n    if (selectedBed) {\r\n        if (room.beds[selectedBed] !== null) {\r\n            alert(`La cama ${selectedBed} ya estÃ¡ ocupada en esta habitaciÃ³n.`);\r\n            return;\r\n        }\r\n        emptyBed = selectedBed;\r\n    } else {\r\n        emptyBed = Object.keys(room.beds).find(bed => room.beds[bed] === null);\r\n    }\r\n    if (!emptyBed) {\r\n        alert('La habitaciÃ³n estÃ¡ llena. No hay camas disponibles.');\r\n        return;\r\n    }\r\n    \r\n    // Remove student from previous room\r\n    if (student.habitacion) {\r\n        const previousRoom = rooms.find(r => r.number === student.habitacion);\r\n        if (previousRoom && student.cama) {\r\n            previousRoom.beds[student.cama] = null;\r\n            previousRoom.occupied--;\r\n        }\r\n    }\r\n    \r\n    // Assign to new room and bed\r\n    student.habitacion = roomNumber;\r\n    student.cama = emptyBed;\r\n    room.beds[emptyBed] = studentId;\r\n    room.occupied++;\r\n    \r\n    saveData();\r\n    updateDashboard();\r\n    updateStudentsTable();\r\n    updateRoomsGrid();\r\n    populateDropdowns();\r\n    \r\n    // Reset form\r\n    this.reset();\r\n    \r\n    addActivity(`Asignada habitaciÃ³n ${roomNumber} cama ${emptyBed} a ${student.nombre}`);\r\n});\r\n\r\n// Add absence functionality\r\ndocument.getElementById('addAbsenceForm').addEventListener('submit', function(e) {\r\n    e.preventDefault();\r\n    \r\n    const absence = {\r\n        id: Date.now(),\r\n        studentId: parseInt(document.getElementById('absenceStudent').value),\r\n        fecha: document.getElementById('absenceDate').value,\r\n        descripcion: document.getElementById('absenceDescription').value\r\n    };\r\n    \r\n    absences.push(absence);\r\n    saveData();\r\n    updateDashboard();\r\n    updateAbsencesTable();\r\n    \r\n    // Update resumen if the student is selected\r\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\r\n    if (alumnoSelect && alumnoSelect.value === absence.studentId.toString()) {\r\n        updateAlumnoResumen(absence.studentId);\r\n    }\r\n    \r\n    // Reset form\r\n    this.reset();\r\n    \r\n    addActivity(`Falta registrada para ${students.find(s => s.id === absence.studentId)?.nombre}`);\r\n});\r\n\r\n// Add report ('parte') functionality\r\ndocument.getElementById('addReportForm')?.addEventListener('submit', function(e) {\r\n    if (!e) return; // guard\r\n    e.preventDefault();\r\n\r\n    const report = {\r\n        id: Date.now(),\r\n        studentId: parseInt(document.getElementById('reportStudent').value),\r\n        fecha: document.getElementById('reportDate').value,\r\n        tipo: document.getElementById('reportType').value,\r\n        descripcion: document.getElementById('reportDescription').value\r\n    };\r\n\r\n    reports.push(report);\r\n    saveData();\r\n    updateReportsTable();\r\n    \r\n    // Update resumen if the student is selected\r\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\r\n    if (alumnoSelect && alumnoSelect.value === report.studentId.toString()) {\r\n        updateAlumnoResumen(report.studentId);\r\n    }\r\n\r\n    // Reset form\r\n    this.reset();\r\n\r\n    addActivity(`Parte registrado para ${students.find(s => s.id === report.studentId)?.nombre}`);\r\n});\r\n\r\n// Populate dropdowns\r\nfunction populateDropdowns() {\r\n    const studentDropdowns = ['roomStudent', 'absenceStudent', 'filterStudent', 'seguimientoStudent'];\r\n    \r\n    studentDropdowns.forEach(id => {\r\n        const select = document.getElementById(id);\r\n        const currentValue = select.value;\r\n        \r\n        select.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \r\n            students.map(student => `\r\n                <option value=\"${student.id}\">${student.nombre}</option>\r\n            `).join('');\r\n        \r\n        select.value = currentValue;\r\n    });\r\n\r\n    // Report student select\r\n    const reportSelect = document.getElementById('reportStudent');\r\n    if (reportSelect) {\r\n        const currentValue = reportSelect.value;\r\n        reportSelect.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \r\n            students.map(student => `\r\n                <option value=\"${student.id}\">${student.nombre}</option>\r\n            `).join('');\r\n        reportSelect.value = currentValue;\r\n    }\r\n\r\n    // Seguimiento student select\r\n    const seguimientoSelect = document.getElementById('seguimientoStudent');\r\n    if (seguimientoSelect) {\r\n        const currentValue2 = seguimientoSelect.value;\r\n        seguimientoSelect.innerHTML = '<option value=\"\">Seleccionar alumno</option>' + \r\n            students.map(student => `\r\n                <option value=\"${student.id}\">${student.nombre}</option>\r\n            `).join('');\r\n        seguimientoSelect.value = currentValue2;\r\n        // attach change handler\r\n        seguimientoSelect.removeEventListener('change', updateSeguimientoTable);\r\n        seguimientoSelect.addEventListener('change', function() { updateSeguimientoTable(this.value); });\r\n    }\r\n\r\n    // Resumen alumno select\r\n    const alumnoResumenSelect = document.getElementById('alumnoResumenSelect');\r\n    if (alumnoResumenSelect) {\r\n        const currentValue3 = alumnoResumenSelect.value;\r\n        alumnoResumenSelect.innerHTML = '<option value=\"\">-- Seleccionar alumno --</option>' + \r\n            students.map(student => `\r\n                <option value=\"${student.id}\">${student.nombre}</option>\r\n            `).join('');\r\n        alumnoResumenSelect.value = currentValue3;\r\n        // attach change handler\r\n        alumnoResumenSelect.removeEventListener('change', updateAlumnoResumen);\r\n        alumnoResumenSelect.addEventListener('change', function() { updateAlumnoResumen(this.value); });\r\n    }\r\n    \r\n    const roomSelect = document.getElementById('roomNumber');\r\n    roomSelect.innerHTML = '<option value=\"\">Seleccionar habitaciÃ³n</option>' + \r\n        rooms.map(room => `\r\n            <option value=\"${room.number}\">${room.number} (${room.type}, ${room.occupied}/${room.capacity})</option>\r\n        `).join('');\r\n\r\n    // Update room options based on selected student gender when roomStudent changes\r\n    const roomStudentSelect = document.getElementById('roomStudent');\r\n    if (roomStudentSelect) {\r\n        roomStudentSelect.removeEventListener('change', updateRoomOptionsForSelectedStudent);\r\n        roomStudentSelect.addEventListener('change', updateRoomOptionsForSelectedStudent);\r\n        // Run once to reflect current selection\r\n        updateRoomOptionsForSelectedStudent();\r\n    }\r\n\r\n    // Attach listener to room select to update available bed options\r\n    const roomBedSelect = document.getElementById('roomBed');\r\n    if (roomSelect) {\r\n        roomSelect.removeEventListener('change', updateBedOptionsForSelectedRoom);\r\n        roomSelect.addEventListener('change', updateBedOptionsForSelectedRoom);\r\n        // initialize bed options based on current selection\r\n        updateBedOptionsForSelectedRoom();\r\n    }\r\n}\r\n\r\n// Populate bed options for the selected room\r\nfunction updateBedOptionsForSelectedRoom() {\r\n    const roomSelect = document.getElementById('roomNumber');\r\n    const bedSelect = document.getElementById('roomBed');\r\n    if (!roomSelect || !bedSelect) return;\r\n\r\n    const roomNumber = roomSelect.value;\r\n    bedSelect.innerHTML = '<option value=\"\">Seleccionar cama</option>';\r\n    if (!roomNumber) {\r\n        bedSelect.disabled = true;\r\n        return;\r\n    }\r\n\r\n    const room = rooms.find(r => r.number === roomNumber);\r\n    if (!room) {\r\n        bedSelect.disabled = true;\r\n        return;\r\n    }\r\n\r\n    const bedLetters = Object.keys(room.beds).sort();\r\n    let hasEmpty = false;\r\n    bedLetters.forEach(bed => {\r\n        const occupantId = room.beds[bed];\r\n        if (occupantId === null) {\r\n            hasEmpty = true;\r\n            bedSelect.innerHTML += `<option value=\"${bed}\">Cama ${bed} - Vacante</option>`;\r\n        } else {\r\n            const student = students.find(s => s.id === occupantId);\r\n            const name = student ? student.nombre.split(' ')[0] : 'Ocupada';\r\n            bedSelect.innerHTML += `<option value=\"${bed}\" disabled>Cama ${bed} - Ocupada (${name})</option>`;\r\n        }\r\n    });\r\n\r\n    bedSelect.disabled = !hasEmpty;\r\n}\r\n\r\n// Filter roomNumber options according to selected student's gender\r\nfunction updateRoomOptionsForSelectedStudent() {\r\n    const roomSelect = document.getElementById('roomNumber');\r\n    const roomStudentSelect = document.getElementById('roomStudent');\r\n    if (!roomSelect || !roomStudentSelect) return;\r\n\r\n    const studentId = parseInt(roomStudentSelect.value);\r\n    let allowedRooms = rooms;\r\n\r\n    if (studentId) {\r\n        const student = students.find(s => s.id === studentId);\r\n        if (student) {\r\n            const g = student.gender;\r\n            // Filter rooms by gender only\r\n            allowedRooms = rooms.filter(r => r.gender === g);\r\n        }\r\n    }\r\n\r\n    const currentValue = roomSelect.value;\r\n    roomSelect.innerHTML = '<option value=\"\">Seleccionar habitaciÃ³n</option>' + \r\n        allowedRooms.map(room => {\r\n            const floorLabel = room.floor === 1 ? 'Planta 1' : 'Planta 2';\r\n            const sideLabel = room.side === 'izquierda' ? 'Izquierda' : 'Derecha';\r\n            const genderLabel = room.gender === 'hombre' ? 'Hombres' : 'Mujeres';\r\n            return `\r\n                <option value=\"${room.number}\">${room.number} - ${floorLabel} (${genderLabel}, ${sideLabel}) - ${room.occupied}/${room.capacity}</option>\r\n            `;\r\n        }).join('');\r\n    roomSelect.value = currentValue;\r\n}\r\n\r\n// Update reports table\r\nfunction updateReportsTable() {\r\n    const tbody = document.getElementById('reportsTableBody');\r\n    if (!tbody) return;\r\n\r\n    if (reports.length === 0) {\r\n        tbody.innerHTML = '<tr><td colspan=\"5\" class=\"text-center py-8 text-gray-500\">No hay partes registrados</td></tr>';\r\n        return;\r\n    }\r\n\r\n    tbody.innerHTML = reports.map(report => {\r\n        const student = students.find(s => s.id === report.studentId);\r\n        return `\r\n            <tr class=\"border-b border-gray-100 hover:bg-gray-50\">\r\n                <td class=\"py-3 px-4 font-medium\">${student ? `${student.nombre}` : 'Alumno eliminado'}</td>\r\n                <td class=\"py-3 px-4\">${report.fecha}</td>\r\n                <td class=\"py-3 px-4\">${report.tipo}</td>\r\n                <td class=\"py-3 px-4\">${report.descripcion}</td>\r\n                <td class=\"py-3 px-4\">\r\n                    <button onclick=\"deleteReport(${report.id})\" class=\"text-red-600 hover:text-red-800\">\r\n                        <i class=\"fas fa-trash\"></i>\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// Seguimiento acadÃ©mico\r\ndocument.getElementById('addSeguimientoForm')?.addEventListener('submit', function(e) {\r\n    if (!e) return;\r\n    e.preventDefault();\r\n\r\n    const studentId = parseInt(document.getElementById('seguimientoStudent').value);\r\n    if (!studentId) {\r\n        alert('Seleccione un alumno para registrar el seguimiento');\r\n        return;\r\n    }\r\n\r\n    const asignatura = document.getElementById('seguimientoAsignatura').value;\r\n    const fecha = document.getElementById('seguimientoFecha').value;\r\n    const tipo = document.getElementById('seguimientoTipo').value;\r\n    const nota = document.getElementById('seguimientoNota').value;\r\n    const comentarios = document.getElementById('seguimientoComentarios').value;\r\n\r\n    const student = students.find(s => s.id === studentId);\r\n    if (!student) return;\r\n\r\n    if (!student.academic) student.academic = { records: [] };\r\n\r\n    const record = {\r\n        id: Date.now(),\r\n        fecha,\r\n        asignatura,\r\n        tipo,\r\n        nota,\r\n        comentarios\r\n    };\r\n\r\n    student.academic.records.push(record);\r\n    saveData();\r\n    updateSeguimientoTable(studentId);\r\n    \r\n    // Update resumen if same student is selected\r\n    const alumnoSelect = document.getElementById('alumnoResumenSelect');\r\n    if (alumnoSelect && alumnoSelect.value === studentId.toString()) {\r\n        updateAlumnoResumen(studentId);\r\n    }\r\n\r\n    this.reset();\r\n    addActivity(`Registro acadÃ©mico aÃ±adido para ${student.nombre}: ${asignatura}`);\r\n});\r\n\r\n// Update resumen del alumno\r\nfunction updateAlumnoResumen(studentId) {\r\n    const alumnoResumenCard = document.getElementById('alumnoResumenCard');\r\n    const alumnoResumenNombre = document.getElementById('alumnoResumenNombre');\r\n    const alumnoResumenFaltas = document.getElementById('alumnoResumenFaltas');\r\n    const alumnoResumenPartes = document.getElementById('alumnoResumenPartes');\r\n    const alumnoResumenSuspensas = document.getElementById('alumnoResumenSuspensas');\r\n    \r\n    if (!studentId) {\r\n        alumnoResumenCard.classList.add('hidden');\r\n        return;\r\n    }\r\n\r\n    const student = students.find(s => s.id === parseInt(studentId));\r\n    if (!student) {\r\n        alumnoResumenCard.classList.add('hidden');\r\n        return;\r\n    }\r\n\r\n    // Count faltas\r\n    const faltas = absences.filter(a => a.studentId === parseInt(studentId)).length;\r\n    \r\n    // Count partes\r\n    const partes = reports.filter(r => r.studentId === parseInt(studentId)).length;\r\n    \r\n    // Count suspensas\r\n    let suspensas = 0;\r\n    if (student.academic && student.academic.records) {\r\n        const isFail = (rec) => {\r\n            if (!rec) return false;\r\n            const notaRaw = (rec.nota || '').toString().trim().replace(',', '.');\r\n            const parsed = parseFloat(notaRaw);\r\n            if (!isNaN(parsed)) {\r\n                return parsed < 5;\r\n            }\r\n            const hay = (rec.tipo || '') + ' ' + (rec.comentarios || '') + ' ' + (rec.asignatura || '') + ' ' + (rec.nota || '');\r\n            const hayLc = hay.toLowerCase();\r\n            if (hayLc.includes('susp') || hayLc.includes('suspenso') || hayLc.includes('np') || hayLc.includes('no presentado')) return true;\r\n            return false;\r\n        };\r\n        suspensas = student.academic.records.filter(isFail).length;\r\n    }\r\n\r\n    // Update display\r\n    alumnoResumenNombre.textContent = student.nombre;\r\n    alumnoResumenFaltas.textContent = faltas;\r\n    alumnoResumenPartes.textContent = partes;\r\n    alumnoResumenSuspensas.textContent = suspensas;\r\n    \r\n    alumnoResumenCard.classList.remove('hidden');\r\n}\r\n\r\nfunction updateSeguimientoTable(studentId) {\r\n    const summaryDiv = document.getElementById('seguimientoSummary');\r\n    if (!summaryDiv) return;\r\n\r\n    if (!studentId) {\r\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-gray-500\">Seleccione un alumno para ver sus suspensas por trimestre</p></div>';\r\n        return;\r\n    }\r\n\r\n    const student = students.find(s => s.id === parseInt(studentId));\r\n    if (!student || !student.academic || student.academic.records.length === 0) {\r\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-gray-500\">No hay registros para este alumno</p></div>';\r\n        return;\r\n    }\r\n\r\n    // filter to only failing records (suspensas)\r\n    const isFail = (rec) => {\r\n        if (!rec) return false;\r\n        const notaRaw = (rec.nota || '').toString().trim().replace(',', '.');\r\n        const parsed = parseFloat(notaRaw);\r\n        if (!isNaN(parsed)) {\r\n            return parsed < 5; // numeric threshold: <5 is suspenso\r\n        }\r\n        // if nota not numeric, try keywords in tipo or comentarios or asignatura\r\n        const hay = (rec.tipo || '') + ' ' + (rec.comentarios || '') + ' ' + (rec.asignatura || '') + ' ' + (rec.nota || '');\r\n        const hayLc = hay.toLowerCase();\r\n        if (hayLc.includes('susp') || hayLc.includes('suspenso') || hayLc.includes('np') || hayLc.includes('no presentado')) return true;\r\n        return false;\r\n    };\r\n\r\n    const failing = student.academic.records.filter(isFail);\r\n    \r\n    if (failing.length === 0) {\r\n        summaryDiv.innerHTML = '<div class=\"text-center col-span-3 py-8\"><p class=\"text-green-600 text-lg font-semibold\"><i class=\"fas fa-check-circle mr-2\"></i>Ninguna asignatura suspensa</p></div>';\r\n        return;\r\n    }\r\n\r\n    // Group by trimester\r\n    const trimestres = {\r\n        'Trimestre 1': { count: 0, color: 'red' },\r\n        'Trimestre 2': { count: 0, color: 'orange' },\r\n        'Trimestre 3': { count: 0, color: 'red' }\r\n    };\r\n\r\n    failing.forEach(rec => {\r\n        const fecha = new Date(rec.fecha + 'T00:00:00');\r\n        const mes = fecha.getMonth() + 1;\r\n        \r\n        if (mes >= 9 && mes <= 11) {\r\n            trimestres['Trimestre 1'].count += 1;\r\n        } else if (mes >= 12 || mes <= 3) {\r\n            trimestres['Trimestre 2'].count += 1;\r\n        } else if (mes >= 4 && mes <= 8) {\r\n            trimestres['Trimestre 3'].count += 1;\r\n        }\r\n    });\r\n\r\n    let html = '';\r\n    Object.entries(trimestres).forEach(([trimestre, data]) => {\r\n        const bgColor = data.count === 0 ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300';\r\n        const textColor = data.count === 0 ? 'text-green-800' : 'text-red-800';\r\n        const iconColor = data.count === 0 ? 'text-green-600' : 'text-red-600';\r\n        \r\n        html += `\r\n            <div class=\"border-2 ${bgColor} rounded-lg p-6 text-center\">\r\n                <p class=\"text-sm font-medium text-gray-600 mb-2\">${trimestre}</p>\r\n                <div class=\"text-4xl font-bold ${textColor} mb-2\">\r\n                    <i class=\"fas ${data.count === 0 ? 'fa-check-circle' : 'fa-times-circle'} ${iconColor} mr-2\"></i>${data.count}\r\n                </div>\r\n                <p class=\"text-sm ${textColor} font-semibold\">${data.count === 1 ? 'asignatura suspensa' : 'asignaturas suspensas'}</p>\r\n            </div>\r\n        `;\r\n    });\r\n\r\n    summaryDiv.innerHTML = html;\r\n}\r\n\r\nfunction deleteAcademicRecord(studentId, recordId) {\r\n    if (!confirm('Â¿Eliminar este registro acadÃ©mico?')) return;\r\n    const student = students.find(s => s.id === studentId);\r\n    if (!student || !student.academic) return;\r\n    student.academic.records = student.academic.records.filter(r => r.id !== recordId);\r\n    saveData();\r\n    updateSeguimientoTable(studentId);\r\n    addActivity('Registro acadÃ©mico eliminado');\r\n}\r\n\r\n// helper to open seguimiento section and select a student\r\nfunction openStudentSeguimiento(studentId) {\r\n    showSection('seguimiento');\r\n    const sel = document.getElementById('seguimientoStudent');\r\n    if (sel) {\r\n        sel.value = studentId;\r\n        updateSeguimientoTable(studentId);\r\n    }\r\n}\r\n\r\n// Delete report\r\nfunction deleteReport(reportId) {\r\n    if (confirm('Â¿EstÃ¡ seguro de eliminar este parte?')) {\r\n        reports = reports.filter(r => r.id !== reportId);\r\n        saveData();\r\n        updateReportsTable();\r\n        addActivity('Parte eliminado');\r\n    }\r\n}\r\n\r\n// Filter functionality\r\ndocument.getElementById('filterStudent').addEventListener('change', updateAbsencesTable);\r\ndocument.getElementById('filterDate').addEventListener('change', updateAbsencesTable);\r\ndocument.getElementById('clearFilters').addEventListener('click', function() {\r\n    document.getElementById('filterStudent').value = '';\r\n    document.getElementById('filterDate').value = '';\r\n    updateAbsencesTable();\r\n});\r\n\r\n// Delete student\r\nfunction deleteStudent(studentId) {\r\n    if (confirm('Â¿EstÃ¡ seguro de eliminar este alumno?')) {\r\n        const student = students.find(s => s.id === studentId);\r\n\r\n        // Remove from room\r\n        if (student.habitacion) {\r\n            const room = rooms.find(r => r.number === student.habitacion);\r\n            if (room && student.cama) {\r\n                room.beds[student.cama] = null;\r\n                room.occupied--;\r\n            }\r\n        }\r\n\r\n        // Remove student\r\n        students = students.filter(s => s.id !== studentId);\r\n\r\n        // Remove related absences\r\n        absences = absences.filter(a => a.studentId !== studentId);\r\n\r\n        saveData();\r\n        updateDashboard();\r\n        updateStudentsTable();\r\n        updateRoomsGrid();\r\n        updateAbsencesTable();\r\n        populateDropdowns();\r\n\r\n        addActivity(`Alumno eliminado: ${student.nombre}`);\r\n    }\r\n}\r\n\r\n// Delete absence\r\nfunction deleteAbsence(absenceId) {\r\n    if (confirm('Â¿EstÃ¡ seguro de eliminar esta falta?')) {\r\n        absences = absences.filter(a => a.id !== absenceId);\r\n        saveData();\r\n        updateDashboard();\r\n        updateAbsencesTable();\r\n        \r\n        addActivity(`Falta eliminada`);\r\n    }\r\n}\r\n\r\n// Edit student (simplified version)\r\nfunction editStudent(studentId) {\r\n    const student = students.find(s => s.id === studentId);\r\n    if (!student) return;\r\n    \r\n    // In a real application, this would open a modal or navigate to an edit page\r\n    const newNombre = prompt('Nuevo nombre:', student.nombre);\r\n\r\n    if (newNombre) {\r\n        student.nombre = newNombre;\r\n        saveData();\r\n        updateStudentsTable();\r\n        populateDropdowns();\r\n\r\n        addActivity(`Alumno actualizado: ${newNombre}`);\r\n    }\r\n}\r\n\r\n// Assign room to student (alternative method)\r\nfunction assignRoomToStudent(roomNumber) {\r\n    const room = rooms.find(r => r.number === roomNumber);\r\n    const occupiedCount = Object.values(room.beds).filter(bed => bed !== null).length;\r\n    if (!room || occupiedCount >= room.capacity) return;\r\n    \r\n    const unassignedStudents = students.filter(s => !s.habitacion);\r\n    \r\n    if (unassignedStudents.length === 0) {\r\n        alert('No hay alumnos sin habitaciÃ³n asignada');\r\n        return;\r\n    }\r\n    \r\n    // Find first empty bed\r\n    const emptyBed = Object.keys(room.beds).find(bed => room.beds[bed] === null);\r\n    if (!emptyBed) {\r\n        alert('La habitaciÃ³n estÃ¡ llena');\r\n        return;\r\n    }\r\n    \r\n    const student = unassignedStudents[0];\r\n    student.habitacion = roomNumber;\r\n    student.cama = emptyBed;\r\n    room.beds[emptyBed] = student.id;\r\n    \r\n    saveData();\r\n    updateDashboard();\r\n    updateStudentsTable();\r\n    updateRoomsGrid();\r\n    populateDropdowns();\r\n    \r\n    addActivity(`Asignada habitaciÃ³n ${roomNumber} cama ${emptyBed} a ${student.nombre}`);\r\n}\r\n\r\n// Add activity log\r\nfunction addActivity(activity) {\r\n    const actividadDiv = document.getElementById('actividadReciente');\r\n    const now = new Date();\r\n    const timeString = now.toLocaleString('es-ES');\r\n    \r\n    const activityElement = document.createElement('div');\r\n    activityElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';\r\n    activityElement.innerHTML = `\r\n        <div class=\"flex items-center space-x-3\">\r\n            <i class=\"fas fa-clock text-gray-400\"></i>\r\n            <span class=\"text-sm text-gray-700\">${activity}</span>\r\n        </div>\r\n        <span class=\"text-xs text-gray-500\">${timeString}</span>\r\n    `;\r\n    \r\n    if (actividadDiv.children.length > 0 && actividadDiv.children[0].textContent.includes('No hay actividad reciente')) {\r\n        actividadDiv.innerHTML = '';\r\n    }\r\n    \r\n    actividadDiv.insertBefore(activityElement, actividadDiv.firstChild);\r\n    \r\n    // Keep only last 10 activities\r\n    while (actividadDiv.children.length > 10) {\r\n        actividadDiv.removeChild(actividadDiv.lastChild);\r\n    }\r\n}\r\n\r\n// --- Agenda de deberes (homeworks) ---\r\nfunction getWeekStartISO(date) {\r\n    const d = new Date(date);\r\n    // normalize to Monday as start of the week\r\n    const day = (d.getDay() + 6) % 7; // Monday=0..Sunday=6\r\n    d.setHours(0,0,0,0);\r\n    d.setDate(d.getDate() - day);\r\n    return d.toISOString().slice(0,10); // YYYY-MM-DD\r\n}\r\n\r\nfunction getWeekEndISOFromStart(weekStartISO) {\r\n    const d = new Date(weekStartISO + 'T00:00:00');\r\n    d.setDate(d.getDate() + 6);\r\n    return d.toISOString().slice(0,10);\r\n}\r\n\r\nfunction loadHomeworks() {\r\n    const saved = localStorage.getItem('homeworks');\r\n    if (saved) {\r\n        try { homeworks = JSON.parse(saved); } catch (e) { homeworks = {}; }\r\n    } else {\r\n        homeworks = {};\r\n    }\r\n}\r\n\r\nfunction saveHomeworks() {\r\n    localStorage.setItem('homeworks', JSON.stringify(homeworks));\r\n}\r\n\r\nlet currentAgendaWeekKey = null;\r\n\r\n// Navigation between weeks for homework agenda\r\nfunction previousWeek() {\r\n    if (!currentAgendaWeekKey) {\r\n        currentAgendaWeekKey = getWeekStartISO(new Date());\r\n    }\r\n    const d = new Date(currentAgendaWeekKey + 'T00:00:00');\r\n    d.setDate(d.getDate() - 7);\r\n    currentAgendaWeekKey = d.toISOString().slice(0, 10);\r\n    renderAgenda();\r\n}\r\n\r\nfunction nextWeek() {\r\n    if (!currentAgendaWeekKey) {\r\n        currentAgendaWeekKey = getWeekStartISO(new Date());\r\n    }\r\n    const d = new Date(currentAgendaWeekKey + 'T00:00:00');\r\n    d.setDate(d.getDate() + 7);\r\n    currentAgendaWeekKey = d.toISOString().slice(0, 10);\r\n    renderAgenda();\r\n}\r\n\r\nfunction goToCurrentWeek() {\r\n    currentAgendaWeekKey = getWeekStartISO(new Date());\r\n    renderAgenda();\r\n}\r\n\r\n// Review panel functions\r\nfunction openReviewPanel() {\r\n    const reviewPanel = document.getElementById('reviewPanel');\r\n    const reviewContent = document.getElementById('reviewContent');\r\n    \r\n    if (!reviewPanel) return;\r\n    \r\n    // Get all weeks with homeworks\r\n    const weeks = Object.keys(homeworks).sort().reverse(); // Most recent first\r\n    \r\n    if (weeks.length === 0) {\r\n        reviewContent.innerHTML = `\r\n            <div class=\"text-center py-8\">\r\n                <p class=\"text-gray-500 text-lg\">No hay deberes registrados aÃºn.</p>\r\n            </div>\r\n        `;\r\n        reviewPanel.classList.remove('hidden');\r\n        return;\r\n    }\r\n    \r\n    let html = `\r\n        <div class=\"space-y-4\">\r\n            <p class=\"text-sm text-gray-600 mb-4\">Se encontraron <strong>${weeks.length}</strong> semana(s) con deberes registrados.</p>\r\n    `;\r\n    \r\n    weeks.forEach(weekStart => {\r\n        const weekEnd = getWeekEndISOFromStart(weekStart);\r\n        const startDate = new Date(weekStart + 'T00:00:00');\r\n        const endDate = new Date(weekEnd + 'T00:00:00');\r\n        \r\n        const startStr = startDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n        const endStr = endDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n        \r\n        const weekData = homeworks[weekStart] || {};\r\n        const hasContent = Object.values(weekData).some(v => v && v.trim().length > 0);\r\n        \r\n        // Count how many estudios have content\r\n        const filledStudios = Object.entries(weekData)\r\n            .filter(([, v]) => v && v.trim().length > 0)\r\n            .length;\r\n        \r\n        html += `\r\n            <div class=\"border border-gray-300 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer\" onclick=\"showWeekReview('${weekStart}')\">\r\n                <div class=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <h4 class=\"font-semibold text-gray-800\">Semana: ${startStr} â†’ ${endStr}</h4>\r\n                        <p class=\"text-sm text-gray-600 mt-1\">\r\n                            <i class=\"fas fa-book mr-1\"></i>\r\n                            ${filledStudios > 0 ? `${filledStudios} estudio(s) con deberes` : 'Sin deberes registrados'}\r\n                        </p>\r\n                    </div>\r\n                    <div class=\"text-right\">\r\n                        <button onclick=\"loadWeekFromReview('${weekStart}', event)\" class=\"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors\">\r\n                            <i class=\"fas fa-pencil-alt mr-1\"></i>Editar\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div id=\"weekPreview_${weekStart}\" class=\"mt-3 text-sm text-gray-700 hidden\">\r\n                    <!-- Preview will be generated on click -->\r\n                </div>\r\n            </div>\r\n        `;\r\n    });\r\n    \r\n    html += `</div>`;\r\n    \r\n    reviewContent.innerHTML = html;\r\n    reviewPanel.classList.remove('hidden');\r\n}\r\n\r\nfunction closeReviewPanel() {\r\n    const reviewPanel = document.getElementById('reviewPanel');\r\n    if (reviewPanel) {\r\n        reviewPanel.classList.add('hidden');\r\n    }\r\n}\r\n\r\nfunction showWeekReview(weekStart) {\r\n    const previewDiv = document.getElementById(`weekPreview_${weekStart}`);\r\n    if (!previewDiv) return;\r\n    \r\n    if (previewDiv.classList.contains('hidden')) {\r\n        // Show preview\r\n        const weekData = homeworks[weekStart] || {};\r\n        let html = '<div class=\"space-y-2 mt-2 pt-3 border-t border-gray-200\">';\r\n        \r\n        for (let i = 1; i <= 4; i++) {\r\n            const estudioId = `estudio${i}`;\r\n            const value = weekData[estudioId] || '';\r\n            if (value.trim().length > 0) {\r\n                html += `\r\n                    <div class=\"pl-3 border-l-2 border-indigo-400\">\r\n                        <p class=\"font-medium text-gray-700\">Estudio ${i}:</p>\r\n                        <p class=\"text-gray-600 whitespace-pre-wrap text-sm\">${value.substring(0, 150)}${value.length > 150 ? '...' : ''}</p>\r\n                    </div>\r\n                `;\r\n            }\r\n        }\r\n        \r\n        html += '</div>';\r\n        previewDiv.innerHTML = html;\r\n        previewDiv.classList.remove('hidden');\r\n    } else {\r\n        previewDiv.classList.add('hidden');\r\n    }\r\n}\r\n\r\nfunction loadWeekFromReview(weekStart, event) {\r\n    event.stopPropagation();\r\n    currentAgendaWeekKey = weekStart;\r\n    closeReviewPanel();\r\n    renderAgenda();\r\n    // Scroll to top to see the agenda\r\n    document.getElementById('agenda').scrollIntoView({ behavior: 'smooth' });\r\n}\r\n\r\nfunction renderAgenda() {\r\n    const grid = document.getElementById('agendaGrid');\r\n    const weekSelector = document.getElementById('weekSelector');\r\n    if (!grid) return;\r\n\r\n    // If no week selected, show current week\r\n    if (!currentAgendaWeekKey) {\r\n        currentAgendaWeekKey = getWeekStartISO(new Date());\r\n    }\r\n\r\n    const weekStart = currentAgendaWeekKey;\r\n    const weekEnd = getWeekEndISOFromStart(weekStart);\r\n\r\n    const weekData = homeworks[weekStart] || {};\r\n\r\n    // Format dates for display\r\n    const startDate = new Date(weekStart + 'T00:00:00');\r\n    const endDate = new Date(weekEnd + 'T00:00:00');\r\n    \r\n    const startStr = startDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n    const endStr = endDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n    \r\n    // Update week selector display\r\n    weekSelector.textContent = `${startStr} â†’ ${endStr}`;\r\n\r\n    // Check if this is the current week\r\n    const today = new Date();\r\n    const currentWeekStart = getWeekStartISO(today);\r\n    const isCurrentWeek = weekStart === currentWeekStart;\r\n\r\n    // show week range\r\n    let html = `<div class=\"mb-4\">\r\n        <h3 class=\"text-lg font-medium\">Semana: ${weekStart} â†’ ${weekEnd}</h3>\r\n        ${isCurrentWeek ? '<p class=\"text-sm text-green-600 font-medium\"><i class=\"fas fa-check-circle mr-1\"></i>Esta es la semana actual</p>' : '<p class=\"text-sm text-gray-500\">Semana anterior/futura</p>'}\r\n    </div>`;\r\n    \r\n    html += `<div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">`;\r\n    html += '<!-- Estudios -->';\r\n    \r\n    for (let i = 1; i <= 4; i++) {\r\n        const estudioId = `estudio${i}`;\r\n        const value = (weekData && weekData[estudioId]) ? weekData[estudioId] : '';\r\n        const hasContent = value.trim().length > 0;\r\n        \r\n        html += `\r\n            <div class=\"bg-white p-4 rounded-lg border ${hasContent ? 'border-indigo-300 bg-indigo-50' : 'border-gray-200'}\">\r\n                <h4 class=\"text-md font-semibold mb-2 text-gray-800\">Estudio ${i}</h4>\r\n                <textarea id=\"homework_${estudioId}\" rows=\"6\" class=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500\" placeholder=\"Escribe los deberes para esta semana\">${value}</textarea>\r\n                <div class=\"mt-3 flex items-center justify-between gap-2\">\r\n                    <button onclick=\"saveHomework('${estudioId}')\" class=\"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors\">\r\n                        <i class=\"fas fa-save mr-1\"></i>Guardar\r\n                    </button>\r\n                    <button onclick=\"clearHomework('${estudioId}')\" class=\"text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 px-2 py-1 rounded transition-colors\">\r\n                        <i class=\"fas fa-trash-alt mr-1\"></i>Limpiar\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    html += '</div>';\r\n\r\n    grid.innerHTML = html;\r\n}\r\n\r\nfunction saveHomework(estudioId) {\r\n    if (!currentAgendaWeekKey) currentAgendaWeekKey = getWeekStartISO(new Date());\r\n    if (!homeworks[currentAgendaWeekKey]) homeworks[currentAgendaWeekKey] = {};\r\n    const ta = document.getElementById(`homework_${estudioId}`);\r\n    if (!ta) return;\r\n    homeworks[currentAgendaWeekKey][estudioId] = ta.value;\r\n    saveHomeworks();\r\n    addActivity(`Deberes guardados para ${estudioId} (${currentAgendaWeekKey})`);\r\n    // small feedback\r\n    ta.classList.add('ring-2','ring-green-300');\r\n    setTimeout(() => ta.classList.remove('ring-2','ring-green-300'), 900);\r\n}\r\n\r\nfunction clearHomework(estudioId) {\r\n    const ta = document.getElementById(`homework_${estudioId}`);\r\n    if (!ta) return;\r\n    if (!confirm('Â¿Limpiar los deberes de esta semana para este estudio?')) return;\r\n    ta.value = '';\r\n    if (homeworks[currentAgendaWeekKey]) delete homeworks[currentAgendaWeekKey][estudioId];\r\n    saveHomeworks();\r\n    addActivity(`Deberes limpiados para ${estudioId} (${currentAgendaWeekKey})`);\r\n}\r\n\r\n\r\n// Set today's date as default\r\ndocument.getElementById('absenceDate').valueAsDate = new Date();\r\nif (document.getElementById('reportDate')) {\r\n    document.getElementById('reportDate').valueAsDate = new Date();\r\n}\r\n\r\n// Initialize the application\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    // Load data on page load\r\n    loadData();\r\n});"],"names":["supabaseUrl","supabaseAnonKey","createClient","supabaseKey","supabase","students","absences","reports","homeworks","users","initializeRooms","bedLetters","createRooms","startNum","endNum","gender","floor","side","i","number","beds","letter","calculateAge","dateString","today","birth","age","m","checkBirthdays","currentMonth","currentDay","birthdayStudents","student","birthDate","birthMonth","birthDay","showBirthdayModal","modal","message","names","s","createConfetti","closeBirthdayModal","container","confettiPieces","colors","piece","loadData","studentsData","studentsError","absencesData","absencesError","reportsData","reportsError","updateDashboard","updateStudentsTable","updateRoomsGrid","updateAbsencesTable","updateReportsTable","populateDropdowns","loadHomeworks","renderAgenda","initApp","e","username","password","errorDiv","showSection","link","section","_a","sectionName","addActivity","room","tbody","nacimientoStr","grid","floors","renderRoomCard","occupiedCount","bed","studentId","html","floorData","filterStudent","filterDate","filteredAbsences","absence","roomNumber","selectedBed","r","studentGender","emptyBed","previousRoom","alumnoSelect","updateAlumnoResumen","report","id","select","currentValue","reportSelect","seguimientoSelect","currentValue2","updateSeguimientoTable","alumnoResumenSelect","currentValue3","roomSelect","roomStudentSelect","updateRoomOptionsForSelectedStudent","updateBedOptionsForSelectedRoom","bedSelect","hasEmpty","occupantId","name","allowedRooms","g","floorLabel","sideLabel","genderLabel","asignatura","fecha","tipo","nota","comentarios","record","alumnoResumenCard","alumnoResumenNombre","alumnoResumenFaltas","alumnoResumenPartes","alumnoResumenSuspensas","faltas","a","partes","suspensas","isFail","rec","notaRaw","parsed","hayLc","summaryDiv","failing","trimestres","mes","trimestre","data","bgColor","textColor","iconColor","activity","actividadDiv","timeString","activityElement","getWeekStartISO","date","d","day","getWeekEndISOFromStart","weekStartISO","saved","currentAgendaWeekKey","weekSelector","weekStart","weekEnd","weekData","startDate","endDate","startStr","endStr","currentWeekStart","estudioId","value","hasContent"],"mappings":"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"}